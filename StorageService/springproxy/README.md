# SpringProxy Service

SpringProxy Service - —ç—Ç–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å –Ω–∞ –±–∞–∑–µ Spring Boot —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Spring WebFlux, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º StorageService.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **Spring Boot 3.4.5** —Å Java 21
- **Spring WebFlux** –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **WebClient** –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- **Mono** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- **ApiPaths enum** –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É—Ç—è–º–∏ API
- **Connection Pooling** –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ StorageService

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
springproxy/
‚îú‚îÄ‚îÄ build.gradle                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ README.md                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ README-docker.md                 # Docker –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è  
‚îú‚îÄ‚îÄ Dockerfile                       # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.override.yml      # Override –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ .dockerignore                    # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Docker
‚îú‚îÄ‚îÄ src/main/java/com/storage/springproxy/
‚îÇ   ‚îú‚îÄ‚îÄ SpringProxyApplication.java      # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebClientConfig.java         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WebClient
‚îÇ   ‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ApiPaths.java                # Enum —Å –ø—É—Ç—è–º–∏ API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StorageServiceClient.java    # –ö–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å StorageService
‚îÇ   ‚îú‚îÄ‚îÄ example/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ApiPathsExample.java         # –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ApiPaths
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebClientTimeoutExample.java # –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ controller/                      # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ       ‚îú‚îÄ‚îÄ ArtifactProxyController.java
‚îÇ       ‚îú‚îÄ‚îÄ ContractProxyController.java
‚îÇ       ‚îú‚îÄ‚îÄ DocumentTypeProxyController.java
‚îÇ       ‚îú‚îÄ‚îÄ DynamicDocumentProxyController.java
‚îÇ       ‚îú‚îÄ‚îÄ InsuranceProxyController.java
‚îÇ       ‚îú‚îÄ‚îÄ PrimaryCacheProxyController.java
‚îÇ       ‚îú‚îÄ‚îÄ PropertyTypeProxyController.java
‚îÇ       ‚îú‚îÄ‚îÄ RootProxyController.java
‚îÇ       ‚îî‚îÄ‚îÄ ZkProxyController.java
‚îî‚îÄ‚îÄ src/main/resources/
    ‚îú‚îÄ‚îÄ application.yml                  # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ application-dev.yml              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    ‚îú‚îÄ‚îÄ application-prod.yml             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è production
    ‚îî‚îÄ‚îÄ application-docker.yml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Docker
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `application.yml`:

```yaml
server:
  port: 8081                          # –ü–æ—Ä—Ç SpringProxy —Å–µ—Ä–≤–∏—Å–∞

storage-service:
  url: http://localhost:8080          # URL –æ—Å–Ω–æ–≤–Ω–æ–≥–æ StorageService

# WebClient timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤—Å–µ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
webclient:
  timeout:
    connection: 5000     # 5 —Å–µ–∫—É–Ω–¥ - –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    response: 30000      # 30 —Å–µ–∫—É–Ω–¥ - –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
    read: 30000          # 30 —Å–µ–∫—É–Ω–¥ - –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    write: 30000         # 30 —Å–µ–∫—É–Ω–¥ - –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö
  pool:
    max-connections: 100        # –ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ø—É–ª–µ
    max-idle-time: 20000       # 20 —Å–µ–∫—É–Ω–¥ - –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```

### –ü—Ä–æ—Ñ–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

**Development (`application-dev.yml`):**
- –ú—è–≥–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã (60 —Å–µ–∫—É–Ω–¥) –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ—Ç–ª–∞–¥–∫–∏
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö HTTP –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–µ–Ω—å—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ø—É–ª–µ (50)

**Production (`application-prod.yml`):**
- –ñ–µ—Å—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã (15 —Å–µ–∫—É–Ω–¥) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ fail-fast
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
- –ë–æ–ª—å—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ø—É–ª–µ (200)

### –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏:
```bash
# Development
./gradlew :springproxy:bootRun --args='--spring.profiles.active=dev'

# Production  
./gradlew :springproxy:bootRun --args='--spring.profiles.active=prod'
```

## API Endpoints

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ StorageService:

### Artifact API
- `POST /api/v2/artifact/new` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
- `POST /api/v2/artifact/{count}/generate` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- `GET /api/v2/artifact?key={key}&value={value}` - –ü–æ–∏—Å–∫ –ø–æ JSON –ø–æ–ª—é
- `POST /api/v2/artifact/json` - –ü–æ–∏—Å–∫ –ø–æ –Ω–∞—Ç–∏–≤–Ω—ã–º JSON –ø–æ–ª—è–º
- `POST /api/v2/artifact/customFields` - –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø–æ–ª—è–º

### Contract API
- `POST /api/v2/contract/new` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
- `GET /api/v2/contract?name={name}` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø–æ –∏–º–µ–Ω–∏
- `POST /api/v2/contract/{count}/generate` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

### DocumentType API
- `POST /api/v2/documentType/new` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `GET /api/v2/documentType?name={name}` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

### –ò –¥—Ä—É–≥–∏–µ API...

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π StorageService –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ SpringProxy —Å–µ—Ä–≤–∏—Å:

```bash
./gradlew :springproxy:bootRun
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8083.

### Docker –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤–∫–ª—é—á–∞—è SpringProxy)
docker-compose up --build

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ SpringProxy
docker-compose up springproxy
```

SpringProxy –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8083: http://localhost:8083

### Health Check

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl http://localhost:8083/actuator/health

# –í—Å–µ Actuator —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
curl http://localhost:8083/actuator
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Docker: [README-docker.md](README-docker.md)

## –û—Ç–ª–∏—á–∏—è –æ—Ç proxy-service

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | proxy-service (Micronaut) | springproxy (Spring Boot) |
|---|---|---|
| –§—Ä–µ–π–º–≤–æ—Ä–∫ | Micronaut 4.3.8 | Spring Boot 3.4.5 |
| HTTP Client | Micronaut HTTP Client | Spring WebClient |
| –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å | Void/HttpResponse | Mono<Void>/Mono<Object> |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | @Client –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è | @Bean WebClient |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç—è–º–∏ | –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã | ApiPaths enum |
| –¢–∞–π–º–∞—É—Ç—ã | –ë–∞–∑–æ–≤—ã–µ | –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ (Connection/Response/Read/Write) |
| Connection Pool | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π | –ö–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º |
| –ü—Ä–æ—Ñ–∏–ª–∏ | –ù–µ—Ç | Dev/Prod/Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| –ü–æ—Ä—Ç | 8081 | 8083 |
| Docker | –ù–µ—Ç | Dockerfile + docker-compose |
| Health Check | –ù–µ—Ç | Spring Boot Actuator |

## ApiPaths Enum

–í—Å–µ –ø—É—Ç–∏ API —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ enum `ApiPaths`:

```java
// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
public Mono<Void> addNewArtifact(Object request) {
    return webClient.post()
            .uri(ARTIFACT_NEW.getPath())  // –≤–º–µ—Å—Ç–æ "/api/v2/artifact/new"
            .contentType(MediaType.APPLICATION_JSON)
            .bodyValue(request)
            .retrieve()
            .bodyToMono(Void.class);
}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ApiPaths enum:
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç—è–º–∏ API
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–ø–µ—á–∞—Ç–æ–∫ –≤ URL
- ‚úÖ –£–¥–æ–±–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—É—Ç–µ–π
- ‚úÖ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE
- ‚úÖ –õ—É—á—à–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

## WebClient —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏

### –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã:

**üïê Connection Timeout (5s)** - –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
**‚è±Ô∏è Response Timeout (30s)** - –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞—á–∞–ª–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞  
**üìñ Read Timeout (30s)** - –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–æ–∫–µ—Ç–∞
**üìù Write Timeout (30s)** - –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–∫–µ—Ç

### Connection Pool:
- **Max Connections:** 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Max Idle Time:** 20 —Å–µ–∫—É–Ω–¥ –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Max Life Time:** 10 –º–∏–Ω—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏
- **Pending Acquire:** 10 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑ –ø—É–ª–∞

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç—å—é  
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

